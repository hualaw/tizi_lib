function getMathmlFromAppletCode(appletCode){var optionForm=document.getElementById("optionForm");appletObject=wrs_int_opener.wrs_createObject(appletCode,document),optionForm.width.value=parseInt(appletObject.width),optionForm.height.value=parseInt(appletObject.height);for(var params=appletObject.childNodes,mathml="",i=0;i<params.length;++i)"xmlinitialtext"==params[i].name?mathml=params[i].value:"requestfirstevaluation"==params[i].name?optionForm.executeonload.checked="true"==params[i].value?!0:!1:"toolbar"==params[i].name?optionForm.toolbar.checked="floating"==params[i].value?!1:!0:"requestfocus"==params[i].name?optionForm.focusonload.checked="true"==params[i].value?!0:!1:"level"==params[i].name&&(optionForm.level.checked="primary"==params[i].value?!0:!1);return mathml}function createIframePath(params){var iframePath=wrs_int_opener._wrs_conf_CASPath;iframePath+=(-1==iframePath.indexOf("?")?"?":"&")+"mode=applet&";for(var i in params)iframePath+=wrs_int_opener.wrs_urlencode(i)+"="+wrs_int_opener.wrs_urlencode(params[i]);return iframePath}function createIframe(params){var iframe=document.createElement("iframe");iframe.id="appletContainerIframe",iframe.src=createIframePath(params),iframe.width="100%",iframe.height="100%",iframe.frameBorder=0,wrs_int_opener.wrs_addEvent(iframe,"load",function(){function setAppletMathml(){try{applet.isActive()?applet.setXML(initialXML):setTimeout(setAppletMathml,50)}catch(e){setTimeout(setAppletMathml,50)}}if(initialXML.length>0){var applet=iframe.contentWindow.document.getElementById("applet");setAppletMathml()}}),document.getElementById("appletContainer").appendChild(iframe)}function reloadIframe(params){var iframe=document.getElementById("appletContainerIframe"),applet=iframe.contentWindow.document.getElementById("applet");initialXML=applet.getXML(),iframe.src=createIframePath(params)}var wrs_int_opener,appletObject,initialXML="",closeFunction;if(window.opener)wrs_int_opener=window.opener,closeFunction=window.close;else for(wrs_int_opener=window.parent;wrs_int_opener.InnerDialogLoaded;)wrs_int_opener=wrs_int_opener.parent;window.parent.InnerDialogLoaded?(window.parent.InnerDialogLoaded(),closeFunction=window.parent.Cancel):window.opener.parent.FCKeditorAPI&&(wrs_int_opener=window.opener.parent),wrs_int_opener.wrs_addEvent(window,"load",function(){var languageList=document.getElementById("languageList");wrs_int_opener.wrs_addEvent(languageList,"change",function(){reloadIframe({lang:languageList.value})});var language;if(wrs_int_opener._wrs_isNewElement){for(var queryParams=wrs_int_opener.wrs_getQueryParams(window),availableLangs=new Array,i=0;i<languageList.options.length;i++)availableLangs[i]=languageList.options[i].value;language="undefined"!=typeof queryParams.lang&&-1!=wrs_int_opener.wrs_arrayContains(availableLangs,queryParams.lang)?queryParams.lang:"undefined"!=typeof queryParams.lang&&-1!=wrs_int_opener.wrs_arrayContains(availableLangs,queryParams.lang.substr(0,2))?queryParams.lang.substr(0,2):wrs_int_opener._wrs_int_language}else{var appletCode=wrs_int_opener._wrs_temporalImage.getAttribute(wrs_int_opener._wrs_conf_CASMathmlAttribute);initialXML=getMathmlFromAppletCode(wrs_int_opener.wrs_mathmlDecode(appletCode));var language="",languageStart=initialXML.indexOf('lang="');if(-1!=languageStart){var languageEnd=initialXML.indexOf('"',languageStart+6);-1!=languageEnd&&(language=initialXML.substring(languageStart+6,languageEnd))}}createIframe({lang:language});for(var i=languageList.options.length-1;i>=0;--i)languageList.options[i].value==language&&(languageList.selectedIndex=i,i=0);wrs_int_opener.wrs_addEvent(document.getElementById("submit"),"click",function(){function finish(){if(applet.getSize().width!=newWidth||applet.getSize().height!=newHeight)setTimeout(finish,100);else{var image=applet.getImageBase64("png");window.parent.InnerDialogLoaded&&window.parent.FCKBrowserInfo.IsIE?(closeFunction(),wrs_int_opener.wrs_int_updateCAS(appletCode,image,newWidth,newHeight)):(wrs_int_opener.wrs_int_updateCAS(appletCode,image,newWidth,newHeight),closeFunction())}}var applet=document.getElementById("appletContainerIframe").contentWindow.document.getElementById("applet"),optionForm=document.getElementById("optionForm"),newWidth=parseInt(optionForm.width.value),newHeight=parseInt(optionForm.height.value),appletCode='<applet alt="WIRIS cas" class="Wiriscas" align="middle" ';appletCode+='codebase="'+applet.getAttribute("codebase")+'" ',appletCode+='archive="'+applet.getAttribute("archive")+'" ',appletCode+='code="'+applet.getAttribute("code")+'" ',appletCode+='width="'+newWidth+'" height="'+newHeight+'">',appletCode+='<param name="requestfirstevaluation" value="'+(optionForm.executeonload.checked?"true":"false")+'"></param>',appletCode+='<param name="toolbar" value="'+(optionForm.toolbar.checked?"true":"floating")+'"></param>',appletCode+='<param name="requestfocus" value="'+(optionForm.focusonload.checked?"true":"false")+'"></param>',appletCode+='<param name="level" value="'+(optionForm.level.checked?"primary":"false")+'"></param>',appletCode+='<param name="xmlinitialtext" value="'+wrs_int_opener.wrs_htmlentities(applet.getXML())+'"></param>',appletCode+='<param name="interface" value="false"></param><param name="commands" value="false"></param><param name="command" value="false"></param>',appletCode+="</applet>",applet.style.width=newWidth+"px",applet.style.height=newHeight+"px",finish()}),wrs_int_opener.wrs_addEvent(document.getElementById("cancel"),"click",function(){closeFunction()});var acceptButton=document.getElementById("submit");null!=strings.accept&&(acceptButton.value=strings.accept);var cancelButton=document.getElementById("cancel");null!=strings.cancel&&(cancelButton.value=strings.cancel),setInterval(function(){document.getElementById("appletContainer").style.height=document.getElementById("optionForm").offsetHeight-document.getElementById("controls").offsetHeight-5+"px"},100)}),wrs_int_opener.wrs_addEvent(window,"unload",function(){wrs_int_opener.wrs_int_notifyWindowClosed()});