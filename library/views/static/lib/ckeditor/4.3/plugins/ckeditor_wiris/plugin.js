function wrs_int_openNewFormulaEditor(element,language,isIframe){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_int_window_opened=!0,_wrs_isNewElement=!0,_wrs_int_temporalElement=element,_wrs_int_temporalElementIsIframe=isIframe,_wrs_int_window=wrs_openEditorWindow(language,element,isIframe))}function wrs_int_openNewCAS(element,isIframe,language){_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_int_window_opened=!0,_wrs_isNewElement=!0,_wrs_int_temporalElement=element,_wrs_int_temporalElementIsIframe=isIframe,_wrs_int_window=wrs_openCASWindow(element,isIframe,language))}function wrs_int_doubleClickHandlerForDiv(editor,div,element){wrs_int_doubleClickHandler(editor,div,!1,element)}function wrs_int_doubleClickHandlerForIframe(editor,iframe,element){wrs_int_doubleClickHandler(editor,iframe,!0,element)}function wrs_int_doubleClickHandler(editor,target,isIframe,element){"img"==element.nodeName.toLowerCase()&&(wrs_containsClass(element,_wrs_conf_imageClassName)?_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_temporalImage=element,wrs_int_openExistingFormulaEditor(target,isIframe,editor.langCode)):wrs_containsClass(element,_wrs_conf_CASClassName)&&(_wrs_int_window_opened?_wrs_int_window.focus():(_wrs_temporalImage=element,wrs_int_openExistingCAS(target,isIframe,editor.langCode))))}function wrs_int_openExistingFormulaEditor(element,isIframe,language){_wrs_int_window_opened=!0,_wrs_isNewElement=!1,_wrs_int_temporalElement=element,_wrs_int_temporalElementIsIframe=isIframe,_wrs_int_window=wrs_openEditorWindow(language,element,isIframe)}function wrs_int_openExistingCAS(element,isIframe,language){_wrs_int_window_opened=!0,_wrs_isNewElement=!1,_wrs_int_temporalElement=element,_wrs_int_temporalElementIsIframe=isIframe,_wrs_int_window=wrs_openCASWindow(element,isIframe,language)}function wrs_int_mousedownHandler(iframe,element){"img"==element.nodeName.toLowerCase()&&(wrs_containsClass(element,"Wirisformula")||wrs_containsClass(element,"Wiriscas"))&&(_wrs_int_temporalImageResizing=element)}function wrs_int_mouseupHandler(){_wrs_int_temporalImageResizing&&setTimeout(function(){_wrs_int_temporalImageResizing.removeAttribute("style"),_wrs_int_temporalImageResizing.removeAttribute("width"),_wrs_int_temporalImageResizing.removeAttribute("height")},10)}function wrs_int_updateFormula(mathml,editMode,language){_wrs_int_temporalElementIsIframe?wrs_updateFormula(_wrs_int_temporalElement.contentWindow,_wrs_int_temporalElement.contentWindow,mathml,_wrs_int_wirisProperties,editMode,language):wrs_updateFormula(_wrs_int_temporalElement,window,mathml,_wrs_int_wirisProperties,editMode,language)}function wrs_int_updateCAS(appletCode,image,width,height){_wrs_int_temporalElementIsIframe?wrs_updateCAS(_wrs_int_temporalElement.contentWindow,_wrs_int_temporalElement.contentWindow,appletCode,image,width,height):wrs_updateCAS(_wrs_int_temporalElement,window,appletCode,image,width,height)}function wrs_int_notifyWindowClosed(){_wrs_int_window_opened=!1}var script=document.createElement("script");script.type="text/javascript",script.src=CKEDITOR.basePath+"/plugins/ckeditor_wiris/core/core.js",document.getElementsByTagName("head")[0].appendChild(script);var _wrs_conf_editorEnabled=!0,_wrs_conf_CASEnabled=!1,_wrs_conf_imageMathmlAttribute="data-mathml",_wrs_conf_CASMathmlAttribute="alt",_wrs_conf_editorPath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/editor.php",_wrs_conf_editorAttributes="width=570, height=450, scroll=no, resizable=yes",_wrs_conf_CASPath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/cas.php",_wrs_conf_CASAttributes="width=640, height=480, scroll=no, resizable=yes",_wrs_conf_createimagePath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/createimage.php",_wrs_conf_createcasimagePath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/createcasimage.php",_wrs_conf_getmathmlPath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/getmathml.php",_wrs_conf_servicePath=CKEDITOR.basePath+"/plugins/ckeditor_wiris/integration/service.php",_wrs_conf_saveMode="tags",_wrs_conf_parseModes=["latex"],_wrs_editImgSrc="",_wrs_conf_enableAccessibility=!0,_wrs_int_editorIcon=CKEDITOR.basePath+"/plugins/ckeditor_wiris/core/icons/formula.gif",_wrs_int_CASIcon=CKEDITOR.basePath+"/plugins/ckeditor_wiris/core/icons/cas.gif",_wrs_int_temporalElement,_wrs_int_temporalElementIsIframe,_wrs_int_window,_wrs_int_window_opened=!1,_wrs_int_temporalImageResizing,_wrs_int_wirisProperties,_wrs_int_directionality;CKEDITOR.plugins.add("ckeditor_wiris",{init:function(editor){function whenDocReady(){if(window.wrs_initParse&&null!=lastDataSet){var newData=wrs_initParse(lastDataSet);editor.setData(newData,function(){var changingMode=!1;editor.on("beforeSetMode",function(){changingMode=!0}),editor.on("mode",function(){changingMode=!1}),editor.on("getData",function(e){changingMode||(e.data.dataValue=wrs_endParse(e.data.dataValue))}),editor._.events.doubleclick&&(editor._.events.doubleclick.listeners=[])})}else setTimeout(whenDocReady,50)}function checkElement(){try{var newElement;if(editor.elementMode==CKEDITOR.ELEMENT_MODE_INLINE)newElement=editor.element.$;else{var elem=document.getElementById("cke_contents_"+editor.name)?document.getElementById("cke_contents_"+editor.name):document.getElementById("cke_"+editor.name);newElement=elem.getElementsByTagName("iframe")[0]}element!=newElement&&(editor.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?wrs_addElementEvents(newElement,function(div,element){wrs_int_doubleClickHandlerForDiv(editor,div,element)},wrs_int_mousedownHandler,wrs_int_mouseupHandler):wrs_addIframeEvents(newElement,function(iframe,element){wrs_int_doubleClickHandlerForIframe(editor,iframe,element)},wrs_int_mousedownHandler,wrs_int_mouseupHandler),element=newElement)}catch(e){}}var _wrs_toolbarName="toolbar_"+editor.config.toolbar;if(null!=CKEDITOR.config[_wrs_toolbarName])for(var wirisButtonIncluded=!1,i=0;i<CKEDITOR.config[_wrs_toolbarName].length;++i)"wiris"==CKEDITOR.config[_wrs_toolbarName][i].name&&(wirisButtonIncluded?(CKEDITOR.config[_wrs_toolbarName].splice(i,1),i--):wirisButtonIncluded=!0);var element;_wrs_int_directionality=editor.config.contentsLangDirection;var lastDataSet=null;if(editor.on("dataReady",function(){lastDataSet=editor.getData()}),whenDocReady(),setInterval(checkElement,500),_wrs_conf_editorEnabled&&(_wrs_int_directionality=editor.config.contentsLangDirection,editor.addCommand("ckeditor_wiris_openFormulaEditor",{async:!1,canUndo:!1,editorFocus:!1,allowedContent:"img[align,"+_wrs_conf_imageMathmlAttribute+",src,alt](!Wirisformula)",requiredContent:"img[align,"+_wrs_conf_imageMathmlAttribute+",src,alt](Wirisformula)",exec:function(editor){wrs_int_openNewFormulaEditor(element,editor.langCode,editor.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE)}}),editor.ui.addButton("ckeditor_wiris_formulaEditor",{label:"公式编辑器(双击公式即可编辑)",command:"ckeditor_wiris_openFormulaEditor",icon:_wrs_int_editorIcon}),_wrs_int_wirisProperties={},"wirisimagecolor"in editor.config&&(_wrs_int_wirisProperties.color=editor.config.wirisimagecolor),"wirisimagebgcolor"in editor.config&&(_wrs_int_wirisProperties.bgColor=editor.config.wirisimagebgcolor),"wirisbackgroundcolor"in editor.config&&(_wrs_int_wirisProperties.backgroundColor=editor.config.wirisbackgroundcolor),"wirisimagesymbolcolor"in editor.config&&(_wrs_int_wirisProperties.symbolColor=editor.config.wirisimagesymbolcolor),"wirisimagenumbercolor"in editor.config&&(_wrs_int_wirisProperties.numberColor=editor.config.wirisimagenumbercolor),"wirisimageidentcolor"in editor.config&&(_wrs_int_wirisProperties.identColor=editor.config.wirisimageidentcolor),"wiristransparency"in editor.config&&(_wrs_int_wirisProperties.transparency=editor.config.wiristransparency),"wirisimagefontsize"in editor.config&&(_wrs_int_wirisProperties.fontSize=editor.config.wirisimagefontsize),"wirisdpi"in editor.config&&(_wrs_int_wirisProperties.dpi=editor.config.wirisdpi)),_wrs_conf_CASEnabled){var allowedContent="img[width,height,align,src,"+_wrs_conf_CASMathmlAttribute+"](!Wiriscas); ";allowedContent+="applet[width,height,align,code,archive,codebase,alt,src](!Wiriscas); ",allowedContent+="param[name,value]";var requiredContent="img[width,height,align,src,"+_wrs_conf_CASMathmlAttribute+"](Wiriscas); ";requiredContent+="applet[width,height,align,code,archive,codebase,alt,src](!Wiriscas); ",requiredContent+="param[name,value]",editor.addCommand("ckeditor_wiris_openCAS",{async:!1,canUndo:!1,editorFocus:!1,allowedContent:allowedContent,requiredContent:requiredContent,exec:function(editor){wrs_int_openNewCAS(element,editor.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE,editor.langCode)}}),editor.ui.addButton("ckeditor_wiris_CAS",{label:"WIRIS cas",command:"ckeditor_wiris_openCAS",icon:_wrs_int_CASIcon})}}});