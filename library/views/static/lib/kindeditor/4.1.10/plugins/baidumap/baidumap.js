KindEditor.plugin("baidumap",function(K){var self=this,name="baidumap",lang=self.lang(name+"."),mapWidth=K.undef(self.mapWidth,558),mapHeight=K.undef(self.mapHeight,360);self.clickToolbar(name,function(){function ready(){win=iframe[0].contentWindow,doc=K.iframeDoc(iframe)}var win,doc,html=['<div style="padding:10px 20px;">','<div class="ke-header">','<div class="ke-left">',lang.address+' <input id="kindeditor_plugin_map_address" name="address" class="ke-input-text" value="" style="width:200px;" /> ','<span class="ke-button-common ke-button-outer">','<input type="button" name="searchBtn" class="ke-button-common ke-button" value="'+lang.search+'" />',"</span>","</div>",'<div class="ke-right">','<input type="checkbox" id="keInsertDynamicMap" name="insertDynamicMap" value="1" /> <label for="keInsertDynamicMap">'+lang.insertDynamicMap+"</label>","</div>",'<div class="ke-clearfix"></div>',"</div>",'<div class="ke-map" style="width:'+mapWidth+"px;height:"+mapHeight+'px;"></div>',"</div>"].join(""),dialog=self.createDialog({name:name,width:mapWidth+42,title:self.lang(name),body:html,yesBtn:{name:self.lang("yes"),click:function(){var map=win.map,centerObj=map.getCenter(),center=centerObj.lng+","+centerObj.lat,zoom=map.getZoom(),url=[checkbox[0].checked?self.pluginsPath+"baidumap/index.html":"http://api.map.baidu.com/staticimage","?center="+encodeURIComponent(center),"&zoom="+encodeURIComponent(zoom),"&width="+mapWidth,"&height="+mapHeight,"&markers="+encodeURIComponent(center),"&markerStyles="+encodeURIComponent("l,A")].join("");checkbox[0].checked?self.insertHtml('<iframe src="'+url+'" frameborder="0" style="width:'+(mapWidth+2)+"px;height:"+(mapHeight+2)+'px;"></iframe>'):self.exec("insertimage",url),self.hideDialog().focus()}},beforeRemove:function(){searchBtn.remove(),doc&&doc.write(""),iframe.remove()}}),div=dialog.div,addressBox=K('[name="address"]',div),searchBtn=K('[name="searchBtn"]',div),checkbox=K('[name="insertDynamicMap"]',dialog.div),iframe=K('<iframe class="ke-textarea" frameborder="0" src="'+self.pluginsPath+'baidumap/map.html" style="width:'+mapWidth+"px;height:"+mapHeight+'px;"></iframe>');iframe.bind("load",function(){iframe.unbind("load"),K.IE?ready():setTimeout(ready,0)}),K(".ke-map",div).replaceWith(iframe),searchBtn.click(function(){win.search(addressBox.val())})})});